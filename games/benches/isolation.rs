#![feature(test)]

extern crate test;

use games::{gamerules::GameRules, isolation::IsolationPosition};

fn run_perft() {
    let fens: [&str; 225] = [
        "......../......../p......./.......1/......P./1....... r 1",
        "......../......../p......./.......1/......P./.1...... r 1",
        "......../......../p......./.......1/......P./..1..... r 1",
        "......../......../p......./.......1/......P./...1.... r 1",
        "......../......../p......./.......1/......P./....1... r 1",
        "......../......../p......./.......1/......P./.....1.. r 1",
        "......../......../p......./.......1/......P./......1. r 1",
        "......../......../p......./.......1/......P./.......1 r 1",
        "......../......../p......./.......1/1.....P./........ r 1",
        "......../......../p......./.......1/.1....P./........ r 1",
        "......../......../p......./.......1/..1...P./........ r 1",
        "......../......../p......./.......1/...1..P./........ r 1",
        "......../......../p......./.......1/....1.P./........ r 1",
        "......../......../p......./.......1/.....1P./........ r 1",
        "......../......../p......./.......1/......P1/........ r 1",
        "......../......../p......./1......1/......P./........ r 1",
        "......../......../p......./.1.....1/......P./........ r 1",
        "......../......../p......./..1....1/......P./........ r 1",
        "......../......../p......./...1...1/......P./........ r 1",
        "......../......../p......./....1..1/......P./........ r 1",
        "......../......../p......./.....1.1/......P./........ r 1",
        "......../......../p......./......2/......P./........ r 1",
        "......../......../p1....../.......1/......P./........ r 1",
        "......../......../p.1...../.......1/......P./........ r 1",
        "......../......../p..1..../.......1/......P./........ r 1",
        "......../......../p...1.../.......1/......P./........ r 1",
        "......../......../p....1../.......1/......P./........ r 1",
        "......../......../p.....1./.......1/......P./........ r 1",
        "......../......../p......1/.......1/......P./........ r 1",
        "......../1......./p......./.......1/......P./........ r 1",
        "......../.1....../p......./.......1/......P./........ r 1",
        "......../..1...../p......./.......1/......P./........ r 1",
        "......../...1..../p......./.......1/......P./........ r 1",
        "......../....1.../p......./.......1/......P./........ r 1",
        "......../.....1../p......./.......1/......P./........ r 1",
        "......../......1./p......./.......1/......P./........ r 1",
        "......../.......1/p......./.......1/......P./........ r 1",
        "1......./......../p......./.......1/......P./........ r 1",
        ".1....../......../p......./.......1/......P./........ r 1",
        "..1...../......../p......./.......1/......P./........ r 1",
        "...1..../......../p......./.......1/......P./........ r 1",
        "....1.../......../p......./.......1/......P./........ r 1",
        ".....1../......../p......./.......1/......P./........ r 1",
        "......1./......../p......./.......1/......P./........ r 1",
        ".......1/......../p......./.......1/......P./........ r 1",
        "......../......../p......./.......1/.......P/1....... r 1",
        "......../......../p......./.......1/.......P/.1...... r 1",
        "......../......../p......./.......1/.......P/..1..... r 1",
        "......../......../p......./.......1/.......P/...1.... r 1",
        "......../......../p......./.......1/.......P/....1... r 1",
        "......../......../p......./.......1/.......P/.....1.. r 1",
        "......../......../p......./.......1/.......P/......1. r 1",
        "......../......../p......./.......1/.......P/.......1 r 1",
        "......../......../p......./.......1/1......P/........ r 1",
        "......../......../p......./.......1/.1.....P/........ r 1",
        "......../......../p......./.......1/..1....P/........ r 1",
        "......../......../p......./.......1/...1...P/........ r 1",
        "......../......../p......./.......1/....1..P/........ r 1",
        "......../......../p......./.......1/.....1.P/........ r 1",
        "......../......../p......./.......1/......1P/........ r 1",
        "......../......../p......./1......1/.......P/........ r 1",
        "......../......../p......./.1.....1/.......P/........ r 1",
        "......../......../p......./..1....1/.......P/........ r 1",
        "......../......../p......./...1...1/.......P/........ r 1",
        "......../......../p......./....1..1/.......P/........ r 1",
        "......../......../p......./.....1.1/.......P/........ r 1",
        "......../......../p......./......2/.......P/........ r 1",
        "......../......../p1....../.......1/.......P/........ r 1",
        "......../......../p.1...../.......1/.......P/........ r 1",
        "......../......../p..1..../.......1/.......P/........ r 1",
        "......../......../p...1.../.......1/.......P/........ r 1",
        "......../......../p....1../.......1/.......P/........ r 1",
        "......../......../p.....1./.......1/.......P/........ r 1",
        "......../......../p......1/.......1/.......P/........ r 1",
        "......../1......./p......./.......1/.......P/........ r 1",
        "......../.1....../p......./.......1/.......P/........ r 1",
        "......../..1...../p......./.......1/.......P/........ r 1",
        "......../...1..../p......./.......1/.......P/........ r 1",
        "......../....1.../p......./.......1/.......P/........ r 1",
        "......../.....1../p......./.......1/.......P/........ r 1",
        "......../......1./p......./.......1/.......P/........ r 1",
        "......../.......1/p......./.......1/.......P/........ r 1",
        "1......./......../p......./.......1/.......P/........ r 1",
        ".1....../......../p......./.......1/.......P/........ r 1",
        "..1...../......../p......./.......1/.......P/........ r 1",
        "...1..../......../p......./.......1/.......P/........ r 1",
        "....1.../......../p......./.......1/.......P/........ r 1",
        ".....1../......../p......./.......1/.......P/........ r 1",
        "......1./......../p......./.......1/.......P/........ r 1",
        ".......1/......../p......./.......1/.......P/........ r 1",
        "......../......../p......./......P1/......../1....... r 1",
        "......../......../p......./......P1/......../.1...... r 1",
        "......../......../p......./......P1/......../..1..... r 1",
        "......../......../p......./......P1/......../...1.... r 1",
        "......../......../p......./......P1/......../....1... r 1",
        "......../......../p......./......P1/......../.....1.. r 1",
        "......../......../p......./......P1/......../......1. r 1",
        "......../......../p......./......P1/......../.......1 r 1",
        "......../......../p......./......P1/1......./........ r 1",
        "......../......../p......./......P1/.1....../........ r 1",
        "......../......../p......./......P1/..1...../........ r 1",
        "......../......../p......./......P1/...1..../........ r 1",
        "......../......../p......./......P1/....1.../........ r 1",
        "......../......../p......./......P1/.....1../........ r 1",
        "......../......../p......./......P1/......1./........ r 1",
        "......../......../p......./......P1/.......1/........ r 1",
        "......../......../p......./1.....P1/......../........ r 1",
        "......../......../p......./.1....P1/......../........ r 1",
        "......../......../p......./..1...P1/......../........ r 1",
        "......../......../p......./...1..P1/......../........ r 1",
        "......../......../p......./....1.P1/......../........ r 1",
        "......../......../p......./.....1P1/......../........ r 1",
        "......../......../p1....../......P1/......../........ r 1",
        "......../......../p.1...../......P1/......../........ r 1",
        "......../......../p..1..../......P1/......../........ r 1",
        "......../......../p...1.../......P1/......../........ r 1",
        "......../......../p....1../......P1/......../........ r 1",
        "......../......../p.....1./......P1/......../........ r 1",
        "......../......../p......1/......P1/......../........ r 1",
        "......../1......./p......./......P1/......../........ r 1",
        "......../.1....../p......./......P1/......../........ r 1",
        "......../..1...../p......./......P1/......../........ r 1",
        "......../...1..../p......./......P1/......../........ r 1",
        "......../....1.../p......./......P1/......../........ r 1",
        "......../.....1../p......./......P1/......../........ r 1",
        "......../......1./p......./......P1/......../........ r 1",
        "......../.......1/p......./......P1/......../........ r 1",
        "1......./......../p......./......P1/......../........ r 1",
        ".1....../......../p......./......P1/......../........ r 1",
        "..1...../......../p......./......P1/......../........ r 1",
        "...1..../......../p......./......P1/......../........ r 1",
        "....1.../......../p......./......P1/......../........ r 1",
        ".....1../......../p......./......P1/......../........ r 1",
        "......1./......../p......./......P1/......../........ r 1",
        ".......1/......../p......./......P1/......../........ r 1",
        "......../......../p.....P./.......1/......../1....... r 1",
        "......../......../p.....P./.......1/......../.1...... r 1",
        "......../......../p.....P./.......1/......../..1..... r 1",
        "......../......../p.....P./.......1/......../...1.... r 1",
        "......../......../p.....P./.......1/......../....1... r 1",
        "......../......../p.....P./.......1/......../.....1.. r 1",
        "......../......../p.....P./.......1/......../......1. r 1",
        "......../......../p.....P./.......1/......../.......1 r 1",
        "......../......../p.....P./.......1/1......./........ r 1",
        "......../......../p.....P./.......1/.1....../........ r 1",
        "......../......../p.....P./.......1/..1...../........ r 1",
        "......../......../p.....P./.......1/...1..../........ r 1",
        "......../......../p.....P./.......1/....1.../........ r 1",
        "......../......../p.....P./.......1/.....1../........ r 1",
        "......../......../p.....P./.......1/......1./........ r 1",
        "......../......../p.....P./.......1/.......1/........ r 1",
        "......../......../p.....P./1......1/......../........ r 1",
        "......../......../p.....P./.1.....1/......../........ r 1",
        "......../......../p.....P./..1....1/......../........ r 1",
        "......../......../p.....P./...1...1/......../........ r 1",
        "......../......../p.....P./....1..1/......../........ r 1",
        "......../......../p.....P./.....1.1/......../........ r 1",
        "......../......../p.....P./......2/......../........ r 1",
        "......../......../p1....P./.......1/......../........ r 1",
        "......../......../p.1...P./.......1/......../........ r 1",
        "......../......../p..1..P./.......1/......../........ r 1",
        "......../......../p...1.P./.......1/......../........ r 1",
        "......../......../p....1P./.......1/......../........ r 1",
        "......../......../p.....P1/.......1/......../........ r 1",
        "......../1......./p.....P./.......1/......../........ r 1",
        "......../.1....../p.....P./.......1/......../........ r 1",
        "......../..1...../p.....P./.......1/......../........ r 1",
        "......../...1..../p.....P./.......1/......../........ r 1",
        "......../....1.../p.....P./.......1/......../........ r 1",
        "......../.....1../p.....P./.......1/......../........ r 1",
        "......../......1./p.....P./.......1/......../........ r 1",
        "......../.......1/p.....P./.......1/......../........ r 1",
        "1......./......../p.....P./.......1/......../........ r 1",
        ".1....../......../p.....P./.......1/......../........ r 1",
        "..1...../......../p.....P./.......1/......../........ r 1",
        "...1..../......../p.....P./.......1/......../........ r 1",
        "....1.../......../p.....P./.......1/......../........ r 1",
        ".....1../......../p.....P./.......1/......../........ r 1",
        "......1./......../p.....P./.......1/......../........ r 1",
        ".......1/......../p.....P./.......1/......../........ r 1",
        "......../......../p......P/.......1/......../1....... r 1",
        "......../......../p......P/.......1/......../.1...... r 1",
        "......../......../p......P/.......1/......../..1..... r 1",
        "......../......../p......P/.......1/......../...1.... r 1",
        "......../......../p......P/.......1/......../....1... r 1",
        "......../......../p......P/.......1/......../.....1.. r 1",
        "......../......../p......P/.......1/......../......1. r 1",
        "......../......../p......P/.......1/......../.......1 r 1",
        "......../......../p......P/.......1/1......./........ r 1",
        "......../......../p......P/.......1/.1....../........ r 1",
        "......../......../p......P/.......1/..1...../........ r 1",
        "......../......../p......P/.......1/...1..../........ r 1",
        "......../......../p......P/.......1/....1.../........ r 1",
        "......../......../p......P/.......1/.....1../........ r 1",
        "......../......../p......P/.......1/......1./........ r 1",
        "......../......../p......P/.......1/.......1/........ r 1",
        "......../......../p......P/1......1/......../........ r 1",
        "......../......../p......P/.1.....1/......../........ r 1",
        "......../......../p......P/..1....1/......../........ r 1",
        "......../......../p......P/...1...1/......../........ r 1",
        "......../......../p......P/....1..1/......../........ r 1",
        "......../......../p......P/.....1.1/......../........ r 1",
        "......../......../p......P/......2/......../........ r 1",
        "......../......../p1.....P/.......1/......../........ r 1",
        "......../......../p.1....P/.......1/......../........ r 1",
        "......../......../p..1...P/.......1/......../........ r 1",
        "......../......../p...1..P/.......1/......../........ r 1",
        "......../......../p....1.P/.......1/......../........ r 1",
        "......../......../p.....1P/.......1/......../........ r 1",
        "......../1......./p......P/.......1/......../........ r 1",
        "......../.1....../p......P/.......1/......../........ r 1",
        "......../..1...../p......P/.......1/......../........ r 1",
        "......../...1..../p......P/.......1/......../........ r 1",
        "......../....1.../p......P/.......1/......../........ r 1",
        "......../.....1../p......P/.......1/......../........ r 1",
        "......../......1./p......P/.......1/......../........ r 1",
        "......../.......1/p......P/.......1/......../........ r 1",
        "1......./......../p......P/.......1/......../........ r 1",
        ".1....../......../p......P/.......1/......../........ r 1",
        "..1...../......../p......P/.......1/......../........ r 1",
        "...1..../......../p......P/.......1/......../........ r 1",
        "....1.../......../p......P/.......1/......../........ r 1",
        ".....1../......../p......P/.......1/......../........ r 1",
        "......1./......../p......P/.......1/......../........ r 1",
        ".......1/......../p......P/.......1/......../........ r 1",
    ];

    for fen in fens {
        let mut pos = IsolationPosition::from_fen(fen);
        std::hint::black_box(pos.perft(3));
    }
}

#[cfg(test)]
mod isolation {
    use super::*;
    use test::Bencher;

    #[bench]
    fn perft(b: &mut Bencher) {
        b.iter(|| run_perft());
    }
}
